"use strict";(()=>{var e={};e.id=922,e.ids=[922],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73292:e=>{e.exports=require("fs/promises")},6005:e=>{e.exports=require("node:crypto")},15766:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>y,originalPathname:()=>k,patchFetch:()=>j,requestAsyncStorage:()=>w,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>U,staticGenerationBailout:()=>b});var r={};a.r(r),a.d(r,{DELETE:()=>m,GET:()=>g,POST:()=>f,PUT:()=>p});var s=a(95419),n=a(69108),i=a(99678),o=a(59549),u=a(78070),l=a(73292),d=a.n(l),c=a(18272);async function g(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({message:"Unauthorized: Bearer token missing or invalid"},{status:401});let a=t.substring(7);if("uKkBUm36l8U=w2C_v!@"!==a)return u.default.json({message:"Unauthorized: Invalid Bearer token"},{status:401});let r=await o.db.categories.findMany({orderBy:{createdAt:"asc"},include:{posts:!0,section:!0}});return u.default.json({categories:r,message:"Categories retrieved successfully"},{status:200})}catch(e){return u.default.json({message:"Something went wrong"},{status:500})}}async function m(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({message:"Unauthorized: Bearer token missing or invalid"},{status:401});let a=t.substring(7);if("uKkBUm36l8U=w2C_v!@"!==a)return u.default.json({message:"Unauthorized: Invalid Bearer token"},{status:401});let{id:r}=await e.json(),s=await o.db.categories.findUnique({where:{id:r}});if(!s)return u.default.json({message:"Category not found"},{status:404});await o.db.categories.delete({where:{id:r}});let n=s.imageUrl;return await d().unlink(`public${n}`),u.default.json({message:"Category deleted successfully"},{status:200})}catch(e){return u.default.json({message:"Something went wrong"},{status:500})}}async function f(e){let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({info:"Unauthorized: Bearer token missing or invalid"},{status:401});if("uKkBUm36l8U=w2C_v!@"!==t.substring(7))return u.default.json({info:"Unauthorized: Invalid Bearer token"},{status:401});let r=await e.formData(),s=r.get("title"),n=r.get("description"),i=r.get("meta-title"),l=r.get("meta-description"),d=r.get("cover-image"),g=r.get("section");if(!s||!n||!r)return;let m=`${Date.now()}-${d.name}`;try{let e=a(73292);await e.mkdir("public/uploads/covers/",{recursive:!0}),await e.writeFile(`public/uploads/covers/${m}`,d.stream())}catch(e){return console.error(e),u.default.json({message:"Image upload failed"},{status:400})}let f=function(e){let t=e.replace(/\s+/g,"-"),a=(0,c.Z)();return`${t}-${a.substring(0,8)}`}(s);return await o.db.categories.create({data:{id:f,title:s,metaTitle:i,description:n,metaDescription:l,slug:"body.Slug",imageUrl:`/uploads/covers/${m}`,section:{connect:{id:g}},articles:"body.Article"}}),u.default.json({success:"Category created successfully"},{status:201})}async function p(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({message:"Unauthorized: Bearer token missing or invalid"},{status:401});let a=t.substring(7);if("uKkBUm36l8U=w2C_v!@"!==a)return u.default.json({message:"Unauthorized: Invalid Bearer token"},{status:401});let r=await e.formData(),s=r.get("id"),n=r.get("title"),i=r.get("description"),l=r.get("meta-title"),c=r.get("meta-description"),g=r.get("cover-image"),m=r.get("section"),f=await o.db.categories.findUnique({where:{id:s}});if(!f)return u.default.json({message:"ID not matched"},{status:404});let p=`${Date.now()}-${g.name}`;try{await d().writeFile(`public/uploads/covers/${p}`,g.stream())}catch(e){return console.error(e),u.default.json({message:"Image upload failed"},{status:400})}let h=await o.db.categories.update({where:{id:s},data:{title:n,metaTitle:l,description:i,metaDescription:c,slug:"body.Slug",imageUrl:`/uploads/covers/${p}`,section:{connect:{id:m}},articles:"body.Article"}}),w=f.imageUrl;return await d().unlink(`public${w}`),u.default.json({category:h,message:"Category updated successfully"},{status:200})}catch(e){return u.default.json({message:"Something went wrong"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/(Backend)/api/categories/route",pathname:"/api/categories",filename:"route",bundlePath:"app/(Backend)/api/categories/route"},resolvedPagePath:"/home/wn-061/Arsalan/Image-demo/src/app/(Backend)/api/categories/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:U,serverHooks:v,headerHooks:y,staticGenerationBailout:b}=h,k="/(Backend)/api/categories/route";function j(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:U})}},18272:(e,t,a)=>{a.d(t,{Z:()=>l});var r=a(6005),s=a.n(r);let n={randomUUID:s().randomUUID},i=new Uint8Array(256),o=i.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let l=function(e,t,a){if(n.randomUUID&&!t&&!e)return n.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return o>i.length-16&&(s().randomFillSync(i),o=0),i.slice(o,o+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=r[e];return t}return function(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}(r)}},59549:(e,t,a)=>{a.d(t,{db:()=>s});var r=a(53524);let s=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206],()=>a(15766));module.exports=r})();