"use strict";(()=>{var e={};e.id=760,e.ids=[760],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73292:e=>{e.exports=require("fs/promises")},6005:e=>{e.exports=require("node:crypto")},82748:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>y,originalPathname:()=>B,patchFetch:()=>b,requestAsyncStorage:()=>w,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>U,staticGenerationBailout:()=>k});var r={};a.r(r),a.d(r,{DELETE:()=>m,GET:()=>p,POST:()=>g,PUT:()=>f});var s=a(95419),n=a(69108),o=a(99678),i=a(59549),u=a(78070),l=a(73292),d=a.n(l),c=a(18272);async function g(e){let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({info:"Unauthorized: Bearer token missing or invalid"},{status:401});if("uKkBUm36l8U=w2C_v!@"!==t.substring(7))return u.default.json({info:"Unauthorized: Invalid Bearer token"},{status:401});let a=await e.formData(),r=a.get("title"),s=a.get("description"),n=a.get("category"),o=a.get("tag").split(","),l=a.get("image");a.get("section");let g=`${Date.now()}-${l.name}`;try{let e="public/uploads/posts/";await d().mkdir(e,{recursive:!0}),await d().writeFile(`${e}${g}`,l.stream())}catch(e){return console.error(e),u.default.json({message:"Image upload failed"},{status:400})}let p=function(e){let t=e.replace(/\s+/g,"-"),a=(0,c.Z)();return`${t}-${a.substring(0,8)}`}(r);return await i.db.posts.create({data:{id:p,title:r,description:s,category:{connect:{id:n}},imageUrl:`/uploads/posts/${g}`,postTags:{connectOrCreate:o.map(e=>({where:{id:e},create:{tagId:e}}))}},include:{postTags:!0}}),u.default.json({success:"post created successfully"},{status:201})}async function p(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({info:"Unauthorized: Bearer token missing or invalid"},{status:401});let a=t.substring(7);if("uKkBUm36l8U=w2C_v!@"!==a)return u.default.json({info:"Unauthorized: Invalid Bearer token"},{status:401});let r=await i.db.posts.findMany({orderBy:{createdAt:"desc"},include:{category:!0,postTags:!0}});return u.default.json({posts:r,success:"Posts retrieved successfully"},{status:200})}catch(e){return console.log(e),u.default.json({error:"Something went wrong"},{status:500})}}async function f(e){let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({info:"Unauthorized: Bearer token missing or invalid"},{status:401});if("uKkBUm36l8U=w2C_v!@"!==t.substring(7))return u.default.json({info:"Unauthorized: Invalid Bearer token"},{status:401});let a=await e.formData(),r=a.get("id"),s=a.get("title"),n=a.get("description"),o=a.get("category"),l=a.get("tag").split(","),c=a.get("image");a.get("section");let g=await i.db.posts.findUnique({where:{id:r}}),p=`${Date.now()}-${c.name}`;try{let e="public/uploads/posts/";await d().mkdir(e,{recursive:!0}),await d().writeFile(`${e}${p}`,c.stream())}catch(e){return console.error(e),u.default.json({message:"Image upload failed"},{status:400})}try{let e=await i.db.posts.update({where:{id:r},data:{title:s,description:n,category:{connect:{id:o}},imageUrl:`/uploads/posts/${p}`,postTags:{connectOrCreate:l.map(e=>({where:{id:e},create:{tagId:e}}))}},include:{postTags:!0}}),t=g?.imageUrl;return await d().unlink(`public${t}`),u.default.json({post:e,success:"Post update successfully"},{status:201})}catch(e){return console.log(e),u.default.json({error:"Something went wrong"},{status:500})}}async function m(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return u.default.json({message:"Unauthorized: Bearer token missing or invalid"},{status:401});let a=t.substring(7);if("uKkBUm36l8U=w2C_v!@"!==a)return u.default.json({message:"Unauthorized: Invalid Bearer token"},{status:401});let r=(await e.formData()).get("id"),s=await i.db.posts.findUnique({where:{id:r},include:{postTags:!0}});s&&s.postTags.length>0&&await Promise.all(s.postTags.map(e=>i.db.postTag.delete({where:{id:e.id}}))),await i.db.posts.delete({where:{id:r}});let n=s?.imageUrl;return await d().unlink(`public${n}`),u.default.json({success:"Posts deleted successfully"},{status:200})}catch(e){return console.log(e),u.default.json({error:"Something went wrong"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/(Backend)/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/(Backend)/api/posts/route"},resolvedPagePath:"/home/wn-061/Arsalan/Image-demo/src/app/(Backend)/api/posts/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:U,serverHooks:v,headerHooks:y,staticGenerationBailout:k}=h,B="/(Backend)/api/posts/route";function b(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:U})}},18272:(e,t,a)=>{a.d(t,{Z:()=>l});var r=a(6005),s=a.n(r);let n={randomUUID:s().randomUUID},o=new Uint8Array(256),i=o.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let l=function(e,t,a){if(n.randomUUID&&!t&&!e)return n.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return i>o.length-16&&(s().randomFillSync(o),i=0),o.slice(i,i+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(let e=0;e<16;++e)t[a+e]=r[e];return t}return function(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}(r)}},59549:(e,t,a)=>{a.d(t,{db:()=>s});var r=a(53524);let s=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206],()=>a(82748));module.exports=r})();